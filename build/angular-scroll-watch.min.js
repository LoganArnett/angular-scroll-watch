/*! anguar-scroll-watch
version: 0.1.0
build date: 2014-8-18
author: Chih-Hsuan Fan
https://github.com/pc035860/angular-scroll-watch.git */
!function(t){function n(t,n){var r=[];t:for(var e=0;e<t.length;e++){for(var i=t[e],o=0;o<n.length;o++)if(i==n[o])continue t;r.push(i)}return r}function r(t){if(angular.isArray(t))return t;if(angular.isString(t))return t.split(" ");if(angular.isObject(t)){var n=[];return angular.forEach(t,function(t,r){t&&(n=n.concat(r.split(" ")))}),n}return t}function e(t,n){if(angular.isArray(t)){n=n||[];for(var r=0;r<t.length;r++)n[r]=t[r]}else if(angular.isObject(t)){n=n||{};for(var e in t)!hasOwnProperty.call(t,e)||"$"===e.charAt(0)&&"$"===e.charAt(1)||(n[e]=t[e])}return n||t}var i="swStyle",o="swClass",s="srOn";t.service("scrollWatchService",["$window","$document","$parse","$log","$rootScope","$animate",function(t,i,o,s,a,c){var u=this,l=angular.element(t),f=function(n,r,e){var i;return function(){var o=this,s=arguments;t.clearTimeout(i),i=t.setTimeout(function(){i=null,e||n.apply(o,s)},r),e&&!i&&n.apply(o,s)}},g=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(n){t.setTimeout(n,1e3/60)}}(),h=function(t){var n=0;return angular.forEach(t,function(){n++}),n},p=function(){var t=i[0].documentElement,n=i[0].body;return Math.max(n.scrollHeight,t.scrollHeight,n.offsetHeight,t.offsetHeight,t.clientHeight)},d=function(){var n=i[0].documentElement.clientHeight,r=t.innerHeight;return n>r?r:n},v=function(){return t.pageYOffset},m=function(){function t(){var t,n,r,e=d(),i=p(),s=i-e,a=v();t=function(t){return s+t},n=function(t){return t-s},r=function(r){return r>0?n(r):t(r)},angular.forEach(u.configs,function(r){var e,i,s,c;e=r.lower<0?t(r.lower):r.lower,i=r.upper<0?t(r.upper):r.upper,e>a?(c=0,s={$positive:e,$negative:n(e)}):a>i?(c=1,s={$positive:i,$negative:n(i)}):a>=e&&i>=a&&(c=(a-e)/(i-e),s={$positive:a,$negative:n(a)}),s.$progress=c,s.$percentage=100*c,r._lastProgress&&r._lastProgress!==c?r._lastProgress>c?s.$direction=-1:r._lastProgress<c&&(s.$direction=1):s.$direction=0,r.styleGetter&&o(s,r),r.classGetter&&l(s,r),r.onGetterList&&E(s,r),r._lastProgress=c})}var i,o,l,f,h,m,$,E,y=/((?:>|<)?=?)\s*?((?:-(?!p))|(?:p(?!-)))?(\d+)/;return o=function(t,n){n.target.css(n.styleGetter(n.scope,t))},f=function(t,n){var r=t.attr,e=m(t,n,1);r.$addClass(e)},h=function(t,n){var r=t.attr,e=m(t,n,-1);r.$removeClass(e)},m=function(t,n,r){var e=t.target,i=e.data("$classCounts")||{},o=[];return angular.forEach(n,function(t){(r>0||i[t])&&(i[t]=(i[t]||0)+r,i[t]===+(r>0)&&o.push(t))}),e.data("$classCounts",i),o.join(" ")},$=function(t,r,e){var i=t.target,o=n(e,r),s=n(r,e);s=m(t,s,-1),o=m(t,o,1),0===o.length?c.removeClass(i,s):0===s.length?c.addClass(i,o):c.setClass(i,o,s)},l=function(t,n){var i=n.classGetter(n.scope,t),o=n._oldClassVal,s=r(i||[]);if(o){if(!angular.equals(i,o)){var a=r(o);$(n,a,s)}}else f(n,s);n._oldClassVal=e(i)},E=function(t,n){var r=function(n){var r,e,i,o,a,c,u,l,f,g;return null===(r=n.match(y))?(s.warn("condition syntax error",n),!1):(c=function(t,n){return t==n},u=function(t,n){return n>t},l=function(t,n){return t>n},f=function(t,n){return n>=t},g=function(t,n){return t>=n},e={"=":c,"<":u,">":l,"<=":f,">=":g}[r[1]],i=r[2]||null,o=Number(r[3]),a="$positive","p"===i?a="$progress":"-"===i&&(a="$negative",o=-o),e(t[a],o))};angular.forEach(n.onGetterList,function(e){var i=r(e.condition);i&&i!==e.lastMatch&&(e.getter(n.scope,t),(n.localDigest?n.scope:a).$digest()),e.lastMatch=i})},i=!1,function(){i||(i=!0,g(function(){t(),i=!1}))}}(),$=f(m,50);this._configId=0,this.configs=null,this.init=function(){this.configs={},l.bind("scroll",m).bind("resize",m)},this.addConfig=function(t){return angular.forEach(["target","lower","upper"],function(n){if(angular.isUndefined(t[n]))throw new Error("`"+n+"` should be provided")}),null===this.configs&&this.init(),this._configId++,t.styleExpr&&(t.styleGetter=o(t.styleExpr)),t.classExpr&&(t.classGetter=o(t.classExpr)),t.onExpr&&(t.localDigest=!!t.localDigest,t.onGetterList=[],angular.forEach(o(t.onExpr)({}),function(n,r){t.onGetterList.push({condition:r,getter:o(n),lastMatch:!1})})),this.configs[this._configId]=t,$(),this._configId},this.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===h(this.configs)&&this.destroy())},this.destroy=function(){this.configs=null,l.unbind("scroll",m).unbind("resize",m)}}]).directive("scrollWatch",["scrollWatchService",function(t){return{restrict:"A",link:function(n,r,e){var a;(e[i]||e[o]||e[s])&&(n.$watch(e.scrollWatch,function(c){c&&angular.isObject(c)&&(a&&t.removeConfig(a),c.target=r,c.scope=n,e[i]&&(c.styleExpr=e[i]),e[o]&&(c.classExpr=e[o],c.attr=e),e[s]&&(c.onExpr=e[s]),a=t.addConfig(c))},!0),r.on("$destroy",function(){a&&t.removeConfig(a)}))}}}])}(angular.module("pc035860.scrollWatch",[]));