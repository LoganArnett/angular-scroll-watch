/*! anguar-scroll-watch
version: 0.4.0
build date: 2014-8-23
author: Chih-Hsuan Fan
https://github.com/pc035860/angular-scroll-watch.git */
!function(t){function n(t,n){var i=[];t:for(var e=0;e<t.length;e++){for(var s=t[e],r=0;r<n.length;r++)if(s==n[r])continue t;i.push(s)}return i}function i(t){if(angular.isArray(t))return t;if(angular.isString(t))return t.split(" ");if(angular.isObject(t)){var n=[];return angular.forEach(t,function(t,i){t&&(n=n.concat(i.split(" ")))}),n}return t}function e(t,n){if(angular.isArray(t)){n=n||[];for(var i=0;i<t.length;i++)n[i]=t[i]}else if(angular.isObject(t)){n=n||{};for(var e in t)!hasOwnProperty.call(t,e)||"$"===e.charAt(0)&&"$"===e.charAt(1)||(n[e]=t[e])}return n||t}var s="swStyle",r="swClass",o="swBroadcast",a="pc035860";t.factory("scrollWatchStageFactory",["$window","$document","$parse","$log","$rootScope","$animate",function(t,s,r,o,a,c){var l=function(n,i,e){var s;return function(){var r=this,o=arguments;t.clearTimeout(s),s=t.setTimeout(function(){s=null,e||n.apply(r,o)},i),e&&!s&&n.apply(r,o)}},u=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(n){t.setTimeout(n,1e3/60)}}(),f=function(t){var n=0;return angular.forEach(t,function(){n++}),n},d=angular.element(t),g=function(t,n){this.init(t,n)},h=g.prototype;return h.name=null,h.element=null,h.configs=null,h._configId=0,h._isWindow=!1,h.init=function(n,i){i=i||d,this.name=n,this.element=i,this.element[0]===t&&(this._isWindow=!0),this.scrollHandler=this._digest.bind(this),this._digestDebounced=l(this._digest,50)},h.bind=function(){this._isWindow?d.bind("scroll",this.scrollHandler).bind("resize",this.scrollHandler):(d.bind("resize",this.scrollHandler),this.element.bind("scroll",this.scrollHandler))},h.unbind=function(){this._isWindow?d.unbind("scroll",this.scrollHandler).unbind("resize",this.scrollHandler):(d.unbind("resize",this.scrollHandler),this.element.unbind("scroll",this.scrollHandler))},h.addConfig=function(t){if(angular.forEach(["target","from","to"],function(n){if(angular.isUndefined(t[n]))throw new Error("`"+n+"` should be provided")}),null===this.configs&&(this.configs={},this.bind()),this._configId++,t.styleExpr&&(t.styleGetter=r(t.styleExpr)),t.classExpr&&(t.classGetter=r(t.classExpr)),t.brdcstExpr){var n=t.scope.$eval(t.brdcstExpr);n.$rootScope?(t.brdcstScope=a,delete n.$rootScope):t.brdcstScope=t.scope,n.$emit?(t.brdcstIsEmit=!0,delete n.$emit):t.brdcstIsEmit=!1,t.brdcstList=[],angular.forEach(n,function(n,i){t.brdcstList.push({condition:r(n),event:i,wasActive:null})})}return this.configs[this._configId]=t,this._digestDebounced(),this._configId},h.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===f(this.configs)&&(this.configs=null,this.unbind()))},h.digest=function(t){this._digest(null,t)},h.destroy=function(){this.configs=null,this.unbind()},h._contentHeight=function(){if(this._isWindow){var t=s[0].documentElement,n=s[0].body;return Math.max(n.scrollHeight,t.scrollHeight,n.offsetHeight,t.offsetHeight,t.clientHeight)}return this.element[0].scrollHeight},h._containerHeight=function(){if(this._isWindow){var n=s[0].documentElement.clientHeight,i=t.innerHeight;return n>i?i:n}return this.element[0].offsetHeight},h._scrollTop=function(){return this._isWindow?t.pageYOffset:this.element[0].scrollTop},h._digest=function(){function t(t){var n,i,e,s,a=this,c=this._containerHeight(),l=this._contentHeight(),u=l-c,f=this._scrollTop();n=function(t){return u+t},i=function(t){return t-u},e=function(t){return t>0?i(t):n(t)},s=function(t){var e,s,a,c;e=t.from<0?n(t.from):t.from,s=t.to<0?n(t.to):t.to,e>f?(c=0,a={$positive:e,$negative:i(e)}):f>s?(c=1,a={$positive:s,$negative:i(s)}):f>=e&&s>=f&&(c=(f-e)/(s-e),a={$positive:f,$negative:i(f)}),a.$progress=c,a.$percentage=100*c,t._lastProgress&&t._lastProgress!==c?t._lastProgress>c?a.$direction=-1:t._lastProgress<c&&(a.$direction=1):a.$direction=0,t.styleGetter&&r(a,t),t.classGetter&&o(a,t),t.brdcstList&&g(a,t),t._lastProgress=c},angular.isUndefined(t)?angular.forEach(a.configs,s):a.configs[t]&&s(a.configs[t])}var s,r,o,a,l,f,d,g,h;return r=function(t,n){n.target.css(n.styleGetter(n.scope,t))},a=function(t,n){var i=t.attr,e=f(t,n,1);i.$addClass(e)},l=function(t,n){var i=t.attr,e=f(t,n,-1);i.$removeClass(e)},f=function(t,n,i){var e=t.target,s=e.data("$classCounts")||{},r=[];return angular.forEach(n,function(t){(i>0||s[t])&&(s[t]=(s[t]||0)+i,s[t]===+(i>0)&&r.push(t))}),e.data("$classCounts",s),r.join(" ")},d=function(t,i,e){var s=t.target,r=n(e,i),o=n(i,e);o=f(t,o,-1),r=f(t,r,1),0===r.length?c.removeClass(s,o):0===o.length?c.addClass(s,r):c.setClass(s,r,o)},o=function(t,n){var s=n.classGetter(n.scope,t),r=n._oldClassVal,o=i(s||[]);if(r){if(!angular.equals(s,r)){var c=i(r);d(n,c,o)}}else a(n,o);n._oldClassVal=e(s)},h=function(t,n){var i=t.$root.$$phase;"$apply"==i||"$digest"==i?n&&"function"==typeof n&&n():t.$apply(n)},g=function(t,n){angular.forEach(n.brdcstList,function(i){var e,s=i.condition(n.scope,t);(null===i.wasActive||s!==i.wasActive)&&(e=n.brdcstIsEmit?"$emit":"$broadcast",h(n.brdcstScope,function(){n.brdcstScope[e](i.event,s,t)})),i.wasActive=s})},s=!1,function(n,i){if(!s||!angular.isUndefined(i)){var e=this;s=!0,u(function(){t.call(e,i),s=!1})}}}(),function(t,n){return new g(t,n)}}]).service("scrollWatchService",["scrollWatchStageFactory","$window","$document","$parse","$log","$rootScope","$animate",function(t){var n=t(a);this.stages={},this.stages[a]=n,this.addConfig=function(t){var n=t.stage||a,i=this.stages[n];return i?[n,i.addConfig(t)]:void 0},this.removeConfig=function(t){var n=t[1],i=this._getStage(t);i&&i.removeConfig(n)},this.digest=function(t){var n=t[1],i=this._getStage(t);i&&i.digest(n)},this._getStage=function(t){var n=t[0];return this.stages[n]}}]).directive("scrollWatch",["scrollWatchService","$parse",function(t){return{restrict:"A",link:function(n,i,e){function a(a){a&&angular.isObject(a)&&(l&&(t.removeConfig(l),(u||angular.noop)()),a.target=i,a.scope=n,e[s]&&(a.styleExpr=e[s]),e[r]&&(a.classExpr=e[r],a.attr=e),e[o]&&(a.brdcstExpr=e[o]),a.digestSync&&(u=n.$watch(c)),l=t.addConfig(a))}function c(){l&&t.digest(l)}var l,u;(e[s]||e[r]||e[o])&&(n.$watch(e.scrollWatch,a,!0),i.on("$destroy",function(){l&&t.removeConfig(l)}))}}}])}(angular.module("pc035860.scrollWatch",[]));