/*! anguar-scroll-watch
version: 0.1.1
build date: 2014-8-19
author: Chih-Hsuan Fan
https://github.com/pc035860/angular-scroll-watch.git */
!function(t){function n(t,n){var r=[];t:for(var e=0;e<t.length;e++){for(var i=t[e],s=0;s<n.length;s++)if(i==n[s])continue t;r.push(i)}return r}function r(t){if(angular.isArray(t))return t;if(angular.isString(t))return t.split(" ");if(angular.isObject(t)){var n=[];return angular.forEach(t,function(t,r){t&&(n=n.concat(r.split(" ")))}),n}return t}function e(t,n){if(angular.isArray(t)){n=n||[];for(var r=0;r<t.length;r++)n[r]=t[r]}else if(angular.isObject(t)){n=n||{};for(var e in t)!hasOwnProperty.call(t,e)||"$"===e.charAt(0)&&"$"===e.charAt(1)||(n[e]=t[e])}return n||t}var i="swStyle",s="swClass",o="swBroadcast";t.service("scrollWatchService",["$window","$document","$parse","$log","$rootScope","$animate",function(t,i,s,o,a,c){var u=this,l=angular.element(t),f=function(n,r,e){var i;return function(){var s=this,o=arguments;t.clearTimeout(i),i=t.setTimeout(function(){i=null,e||n.apply(s,o)},r),e&&!i&&n.apply(s,o)}},g=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(n){t.setTimeout(n,1e3/60)}}(),d=function(t){var n=0;return angular.forEach(t,function(){n++}),n},h=function(){var t=i[0].documentElement,n=i[0].body;return Math.max(n.scrollHeight,t.scrollHeight,n.offsetHeight,t.offsetHeight,t.clientHeight)},v=function(){var n=i[0].documentElement.clientHeight,r=t.innerHeight;return n>r?r:n},m=function(){return t.pageYOffset},p=function(){function t(){var t,n,r,e=v(),i=h(),a=i-e,c=m();t=function(t){return a+t},n=function(t){return t-a},r=function(r){return r>0?n(r):t(r)},angular.forEach(u.configs,function(r){var e,i,a,u;e=r.from<0?t(r.from):r.from,i=r.to<0?t(r.to):r.to,e>c?(u=0,a={$positive:e,$negative:n(e)}):c>i?(u=1,a={$positive:i,$negative:n(i)}):c>=e&&i>=c&&(u=(c-e)/(i-e),a={$positive:c,$negative:n(c)}),a.$progress=u,a.$percentage=100*u,r._lastProgress&&r._lastProgress!==u?r._lastProgress>u?a.$direction=-1:r._lastProgress<u&&(a.$direction=1):a.$direction=0,r.styleGetter&&s(a,r),r.classGetter&&o(a,r),r.brdcstList&&p(a,r),r._lastProgress=u})}var i,s,o,a,l,f,d,p;return s=function(t,n){n.target.css(n.styleGetter(n.scope,t))},a=function(t,n){var r=t.attr,e=f(t,n,1);r.$addClass(e)},l=function(t,n){var r=t.attr,e=f(t,n,-1);r.$removeClass(e)},f=function(t,n,r){var e=t.target,i=e.data("$classCounts")||{},s=[];return angular.forEach(n,function(t){(r>0||i[t])&&(i[t]=(i[t]||0)+r,i[t]===+(r>0)&&s.push(t))}),e.data("$classCounts",i),s.join(" ")},d=function(t,r,e){var i=t.target,s=n(e,r),o=n(r,e);o=f(t,o,-1),s=f(t,s,1),0===s.length?c.removeClass(i,o):0===o.length?c.addClass(i,s):c.setClass(i,s,o)},o=function(t,n){var i=n.classGetter(n.scope,t),s=n._oldClassVal,o=r(i||[]);if(s){if(!angular.equals(i,s)){var c=r(s);d(n,c,o)}}else a(n,o);n._oldClassVal=e(i)},p=function(t,n){angular.forEach(n.brdcstList,function(r){var e,i=r.condition(n.scope,t);(null===r.wasActive||i!==r.wasActive)&&(e=n.brdcstIsEmit?"$emit":"$broadcast",n.brdcstScope[e](r.event,i,t)),r.wasActive=i})},i=!1,function(){i||(i=!0,g(function(){t(),i=!1}))}}(),$=f(p,50);this._configId=0,this.configs=null,this.init=function(){this.configs={},l.bind("scroll",p).bind("resize",p)},this.addConfig=function(t){if(angular.forEach(["target","from","to"],function(n){if(angular.isUndefined(t[n]))throw new Error("`"+n+"` should be provided")}),null===this.configs&&this.init(),this._configId++,t.styleExpr&&(t.styleGetter=s(t.styleExpr)),t.classExpr&&(t.classGetter=s(t.classExpr)),t.brdcstExpr){var n=t.scope.$eval(t.brdcstExpr);n.$rootScope?(t.brdcstScope=a,delete n.$rootScope):t.brdcstScope=t.scope,n.$emit?(t.brdcstIsEmit=!0,delete n.$emit):t.brdcstIsEmit=!1,t.brdcstList=[],angular.forEach(n,function(n,r){t.brdcstList.push({condition:s(n),event:r,wasActive:null})})}return this.configs[this._configId]=t,$(),this._configId},this.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===d(this.configs)&&this.destroy())},this.destroy=function(){this.configs=null,l.unbind("scroll",p).unbind("resize",p)}}]).directive("scrollWatch",["scrollWatchService",function(t){return{restrict:"A",link:function(n,r,e){var a;(e[i]||e[s]||e[o])&&(n.$watch(e.scrollWatch,function(c){c&&angular.isObject(c)&&(a&&t.removeConfig(a),c.target=r,c.scope=n,e[i]&&(c.styleExpr=e[i]),e[s]&&(c.classExpr=e[s],c.attr=e),e[o]&&(c.brdcstExpr=e[o]),a=t.addConfig(c))},!0),r.on("$destroy",function(){a&&t.removeConfig(a)}))}}}])}(angular.module("pc035860.scrollWatch",[]));