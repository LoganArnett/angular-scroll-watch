/*! anguar-scroll-watch
version: 0.2.0
build date: 2014-8-21
author: Chih-Hsuan Fan
https://github.com/pc035860/angular-scroll-watch.git */
!function(t){function n(t,n){var r=[];t:for(var e=0;e<t.length;e++){for(var i=t[e],s=0;s<n.length;s++)if(i==n[s])continue t;r.push(i)}return r}function r(t){if(angular.isArray(t))return t;if(angular.isString(t))return t.split(" ");if(angular.isObject(t)){var n=[];return angular.forEach(t,function(t,r){t&&(n=n.concat(r.split(" ")))}),n}return t}function e(t,n){if(angular.isArray(t)){n=n||[];for(var r=0;r<t.length;r++)n[r]=t[r]}else if(angular.isObject(t)){n=n||{};for(var e in t)!hasOwnProperty.call(t,e)||"$"===e.charAt(0)&&"$"===e.charAt(1)||(n[e]=t[e])}return n||t}var i="swStyle",s="swClass",o="swBroadcast";t.service("scrollWatchService",["$window","$document","$parse","$log","$rootScope","$animate",function(t,i,s,o,a,c){var u=this,l=angular.element(t),f=function(n,r,e){var i;return function(){var s=this,o=arguments;t.clearTimeout(i),i=t.setTimeout(function(){i=null,e||n.apply(s,o)},r),e&&!i&&n.apply(s,o)}},g=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(n){t.setTimeout(n,1e3/60)}}(),d=function(t){var n=0;return angular.forEach(t,function(){n++}),n},h=function(){var t=i[0].documentElement,n=i[0].body;return Math.max(n.scrollHeight,t.scrollHeight,n.offsetHeight,t.offsetHeight,t.clientHeight)},v=function(){var n=i[0].documentElement.clientHeight,r=t.innerHeight;return n>r?r:n},p=function(){return t.pageYOffset},m=function(){function t(t){var n,r,e,i,a=v(),c=h(),l=c-a,f=p();n=function(t){return l+t},r=function(t){return t-l},e=function(t){return t>0?r(t):n(t)},i=function(t){var e,i,a,c;e=t.from<0?n(t.from):t.from,i=t.to<0?n(t.to):t.to,e>f?(c=0,a={$positive:e,$negative:r(e)}):f>i?(c=1,a={$positive:i,$negative:r(i)}):f>=e&&i>=f&&(c=(f-e)/(i-e),a={$positive:f,$negative:r(f)}),a.$progress=c,a.$percentage=100*c,t._lastProgress&&t._lastProgress!==c?t._lastProgress>c?a.$direction=-1:t._lastProgress<c&&(a.$direction=1):a.$direction=0,t.styleGetter&&s(a,t),t.classGetter&&o(a,t),t.brdcstList&&m(a,t),t._lastProgress=c},angular.isUndefined(t)?angular.forEach(u.configs,i):u.configs[t]&&i(u.configs[t])}var i,s,o,a,l,f,d,m;return s=function(t,n){n.target.css(n.styleGetter(n.scope,t))},a=function(t,n){var r=t.attr,e=f(t,n,1);r.$addClass(e)},l=function(t,n){var r=t.attr,e=f(t,n,-1);r.$removeClass(e)},f=function(t,n,r){var e=t.target,i=e.data("$classCounts")||{},s=[];return angular.forEach(n,function(t){(r>0||i[t])&&(i[t]=(i[t]||0)+r,i[t]===+(r>0)&&s.push(t))}),e.data("$classCounts",i),s.join(" ")},d=function(t,r,e){var i=t.target,s=n(e,r),o=n(r,e);o=f(t,o,-1),s=f(t,s,1),0===s.length?c.removeClass(i,o):0===o.length?c.addClass(i,s):c.setClass(i,s,o)},o=function(t,n){var i=n.classGetter(n.scope,t),s=n._oldClassVal,o=r(i||[]);if(s){if(!angular.equals(i,s)){var c=r(s);d(n,c,o)}}else a(n,o);n._oldClassVal=e(i)},m=function(t,n){angular.forEach(n.brdcstList,function(r){var e,i=r.condition(n.scope,t);(null===r.wasActive||i!==r.wasActive)&&(e=n.brdcstIsEmit?"$emit":"$broadcast",n.brdcstScope[e](r.event,i,t)),r.wasActive=i})},i=!1,function(n,r){i&&angular.isUndefined(r)||(i=!0,g(function(){t(r),i=!1}))}}(),$=f(m,50);this._configId=0,this.configs=null,this.init=function(){this.configs={},l.bind("scroll",m).bind("resize",m)},this.addConfig=function(t){if(angular.forEach(["target","from","to"],function(n){if(angular.isUndefined(t[n]))throw new Error("`"+n+"` should be provided")}),null===this.configs&&this.init(),this._configId++,t.styleExpr&&(t.styleGetter=s(t.styleExpr)),t.classExpr&&(t.classGetter=s(t.classExpr)),t.brdcstExpr){var n=t.scope.$eval(t.brdcstExpr);n.$rootScope?(t.brdcstScope=a,delete n.$rootScope):t.brdcstScope=t.scope,n.$emit?(t.brdcstIsEmit=!0,delete n.$emit):t.brdcstIsEmit=!1,t.brdcstList=[],angular.forEach(n,function(n,r){t.brdcstList.push({condition:s(n),event:r,wasActive:null})})}return this.configs[this._configId]=t,$(),this._configId},this.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===d(this.configs)&&this.destroy())},this.digest=function(t){m(null,t)},this.destroy=function(){this.configs=null,l.unbind("scroll",m).unbind("resize",m)}}]).directive("scrollWatch",["scrollWatchService","$parse",function(t){return{restrict:"A",link:function(n,r,e){function a(a){a&&angular.isObject(a)&&(u&&(t.removeConfig(u),(l||angular.noop)()),a.target=r,a.scope=n,e[i]&&(a.styleExpr=e[i]),e[s]&&(a.classExpr=e[s],a.attr=e),e[o]&&(a.brdcstExpr=e[o]),a.digest&&(l=n.$watch(c)),u=t.addConfig(a))}function c(){u&&t.digest(u)}var u,l;(e[i]||e[s]||e[o])&&(n.$watch(e.scrollWatch,a,!0),r.on("$destroy",function(){u&&t.removeConfig(u)}))}}}])}(angular.module("pc035860.scrollWatch",[]));